# Collected data description

This tutorial will walk you through the organization of experiment data from top to bottom.

Each folder in this directory contains a set of collected data with specific settings (explained in [Experiment Sets](#Experiment-Sets)). There are 11 `.txt` files in each folder, recording the collected traces from each device and an additional file from powermeter (explained in [Devices](#Devices)). Finally, each line in a `.txt` files notes collecting time, power, temperature and delay (explained in [Data Traces](#Data-Traces)). We also provide a script for visualization, see [Instructions for Visualization](#Instructions-for-Visualization).

All plots are stored in the `img` folder, with test case as their name. All results are saved in `result.txt`, including the average power and delay in each test case.

The folder `reliot-plot` contains the scripts and data for plots in the paper.

## Test Scenarios in Paper

The core idea is to test power, temperature and reliability under computation offloading and different ambient temperature.

* **Scenario 1:** rpi02, rpi03, rpi04 send 10kB to rpi01 every 200ms. After rpi01 receives the packet, it fires a linear regression of 5kB->4B. The generated 4B and the rest 5kB will be sent to rpi31. rpi31 runs the linear regression of 5KB->4B for the rest 5kB once it receives the packet. Ambient temperature is 25 °C.

* **Scenario 2:** same as scenario 1 setting, but the ambient temperature of rpi01 is 37 °C.

* **Scenario 3:** rpi02, rpi03, rpi04 runs linear regression of 10kB->4B, sending 4B generated data to rpi01. rpi01 directly forwards it to rpi31. The ambient temperature of rpi01 is 37 °C.

## Devices

* **172.27.0.1 (rpi31)** - this is a Raspberry Pi 3B+ running the central broker. Note that the power data in this file is wrong. Due to the wrong setting of shunt resistor value, the real power should be four times the recorded value.

* **172.27.0.2 - 172.27.0.5 (rpi01-rpi04)** - these are Raspberry Pi zeros acting as normal mesh nodes in the network.

* **172.27.0.6 (rpi32)** - this is a Raspberry Pi 3B+. Same as RPi zeros, this Pi is also a client connecting to the central broker as a normal mesh node. At the same time, it also serves as a bridge forwarding all data from ESP8266s to the central broker.

* esp1 - esp4 - there are 4 ESP8266s spreading in the Master's Common room and publishing data through MQTT to the 172.27.0.6.

  <font color="red">With unknown reasons, esp4 is down for most of the time. esp2 may also lose some power packets.</font>

* power_broker.txt - this is an additional file generated by power meter, which is recording the power traces of the central Pi broker (i.e. 172.27.0.1). The reason for using this is that the power measurement of INA219 on the central Pi broker is obviously wrong. So this is an alternative way to obtain accurate power trace on this particular device.

## Old Experiment Sets

* **test_old** - a sample data set collected when all devices are in lab 2115.

  In the old experiment setting, every client samples power and/or temperature every 0.2s, sends 1 Kbytes of fake data into the network each second, and the total experiment runs for 300s.

* **original_old** - setup the network in 2nd floor of CSE building. Power & temperature sampling interval is 0.2s,  with 1kB of fake data sending from every Pi in each second. The total running time is 300s. There is no bandwidth limitation in this case.

* **limit_bw_old** - same setting as **original_old**, with 100kbps limited bandwidth between each pair of Pi's.

* **original_1/2** - setup the network in 2nd floor of CSE building . Power & temperature sampling is 0.2s, with 80kB fake data sending from Pi3's and 20kB fake data sending from Pi zero's in each second. Total experiment time is 300s. In this case, there is a 1.25MB/s (10Mbps) bandwidth limitation on each Pi's Wi-Fi adapter.

  <font color="red">original_1 is bad. It has non-monotinic time stamps and spans to 400 seconds.</font>

* **original_no_bw_1/2** - same setting as **original_1/2** but without the bandwidth setting.

* **limit_bw_1/2** - same setting as **original_1/2**, while the only difference is the bandwidth limitation here is set to 12.5kB/s (100kbps).

* **lr_1/2** - same setting as **original_1/2**, while the only difference is, each device (all Pi's and ESP's) are running certain Linear Regression workloads.

  * For Pi 3, the LR workload is triggered each second, with 100MB input data and 80kB output data. Outputs are sent through MQTT to the central Pi broker after the computation finishes. Each run takes approximately 0.5s in the 1s interval.
  * For Pi zero, similarly, the LR workload is fired each second, with 100MB input data and 20kB output. Outputs are forwarded through MQTT to the central Pi broker after the computation finishes. Each run takes approximately 0.58s on Pi zero in its 1s interval.
  * For ESP8266, due to memory limitation, the LR could only takes 256 floats and output 32 floats. In each 200ms interval, such LR is run for 10 times, costing approximately 90ms in 200ms.

* **limit_bw_lr_1/2** - use bandwidth setting in **limit_bw_1/2**, linear regression setting in **lr_1/2**. The rest settings are the same as **original_1/2**.

* **heat_2_1/2** - same setting as **original_1/2**, while one of the major node on the path, i.e. Pi zero with 172.27.0.2, is being heated thus its ambient temperature increases to 38.4°C, while the normal ambient temperature is 23°C. The core temperature of that Pi zero before running the test is 47°C.

* **heat_3_1/3** - same setting as **original_1/2**, while one of the major node on the path, i.e. Pi zero with 172.27.0.3, is being heated thus its ambient temperature increases to 38.5°C and its core temperature is around 47.1°C before the test starts.

## Data Traces

The data in one line in is slightly different for Pi's and ESP's, as we didn't use the internal temperature sensor on ESP8266 due to accuracy issues.

* On **Pi**, the format of one line of data is as follows:

  ```
  time(s), power(mW), temperature(degrees), delay(s)
  ```

* On **ESP8266**, the format of one line is as follows:

  ```
  time(s), power(mW), delay(s)
  ```

  * time - this is the absolute time on Pi that the power & temperature data is collected, obtained by `time.time()`. All Pi's are synchronized.
  * power - this is measured by INA219, which is attached to each device.
  * temperature - on Pi, this is the internal CPU temperature returned by `vcgenmd`.
  * delay - this is the difference between collection time and the time received by the central broker.

## Instructions for Visualization

Run the `plot.py` script in this folder. You need to specify a test case, i.e. a folder. The following command shows an example to visualize 'original' test data.

```shell
python3 plot.py original
```

All plots are stored in the `img` folder, with test case as their name. All results are saved in `result.txt`.
